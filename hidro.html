<!DOCTYPE html>
<html style="height: auto;">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>AdminLTE 3 | Hidrotérmico</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="resorce/plugins/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="resorce/dist/css/adminlte.min.css">
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <style>
        .tina-card {
            position: relative;
            height: 180px;
            background-color: #94bae7;
            color: white;
            border-radius: 4px;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            cursor: pointer;
        }

        .tina-card:hover {
            transform: scale(1.03);
        }

        .tina-activa {
            background-color: #4db6c6 !important;
        }

        .tina-title {
            font-size: 18px;
            letter-spacing: 2px;
        }

        .tina-num {
            font-size: 36px;
            font-weight: 600;
        }

        .tina-status {
            margin-top: 10px;
            font-size: 14px;
            font-weight: bold;
        }

        .zona-hover {
            outline: 3px dashed #28a745;
        }

        .canasta {
            cursor: grab;
            background-color: #fff3cd;
            min-width: 70px;
            text-align: center;
            font-weight: bold;
        }

        /* NUEVO: Degradado rojo “calor” para los tanques */
        .tina-calor {
            background: linear-gradient(135deg, #ff9999, #ff0000) !important;
        }

        /* EFECTO CALOR HIDROTERMICO */
        .tina-calor-animado::after {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, rgba(255, 0, 0, 0.4) 60%, rgba(255, 0, 0, 0) 100%);
            animation: pulsar 1.2s infinite;
            border-radius: 4px;
            pointer-events: none;
        }

        /* NUEVO: azul fosforescente parpadeante cuando falta 1 minuto */
        .tina-casi-salida {
            background: #00ffff !important; /* azul fosforescente */
            animation: parpadeo 0.7s infinite alternate;
        }

        @keyframes parpadeo {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }


        @keyframes pulsar {
            0% {
                transform: scale(0.8);
                opacity: 0.6;
            }

            50% {
                transform: scale(1.2);
                opacity: 0.9;
            }

            100% {
                transform: scale(0.8);
                opacity: 0.6;
            }
        }
    </style>
</head>

<body class="sidebar-mini sidebar-collapse">

    <div class="wrapper">

        <nav class="main-header navbar navbar-expand navbar-white navbar-light"></nav>

        <aside class="main-sidebar sidebar-dark-primary elevation-4">
            <a class='brand-link' href='/resorce/index3'>
                <img src="resorce/dist/img/AdminLTELogo.png" alt="AdminLTE Logo"
                    class="brand-image img-circle elevation-3" style="opacity: .8">
                <span class="brand-text font-weight-light">AdminLTE 3</span>
            </a>

            <div class="sidebar">
                <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                    <div class="image">
                        <img src="resorce/dist/img/user2-160x160.jpg" class="img-circle elevation-2" alt="User Image">
                    </div>
                    <div class="info">
                        <a href="#" class="d-block">Alexander Pierce</a>
                    </div>
                </div>

                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu"
                        data-accordion="false">
                        <li class="nav-item">
                            <a class='nav-link' href='/'><i class="nav-icon far fa-circle text-warning"></i>
                                <p>Abastecimiento</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class='nav-link' href='/hidro'><i class="nav-icon far fa-circle text-info"></i>
                                <p>Hidrotérmico</p>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </aside>

        <div class="content-wrapper">
            <section class="content pt-3">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Tanques - Hidrotérmico</h3>
                    </div>

                    <div class="card-body">

                        <div class="row">
                            <script>
                                for (let i = 1; i <= 6; i++) {
                                    document.write(`
                                        <div class="col-md-3 col-sm-6 mb-4">
                                            <div class="tina-card" data-tank="${i}">
                                            <div>
                                            <div class="tina-title">TINA</div>
                                            <div class="tina-num">${i.toString().padStart(2, '0')}</div>
                                            <div class="tina-status">DISPONIBLE</div>
                                            </div>
                                            <div class="tank-body" style="position:absolute; inset:0; opacity:0;"></div>
                                            </div>
                                        </div>
                                        `);
                                    }
                            </script>
                        </div>

                        <h6 class="mt-4">Canastas disponibles:</h6>
                        <div class="d-flex flex-wrap mb-3">
                            <div class="canasta border border-success rounded p-2 mr-2 mb-2" data-id="C1"
                                data-tiempo="75">Canasta 1</div>
                            <div class="canasta border border-success rounded p-2 mr-2 mb-2" data-id="C2"
                                data-tiempo="75">Canasta 2</div>
                            <div class="canasta border border-success rounded p-2 mr-2 mb-2" data-id="C3"
                                data-tiempo="75">Canasta 3</div>
                        </div>

                    </div>
                </div>
            </section>
        </div>

        <footer class="main-footer">
            <strong>AdminLTE 3</strong>
        </footer>

    </div>

    <!-- ================= MODAL ================= -->
    <div class="modal fade" id="aperturarModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">

                <div class="modal-header bg-primary">
                    <h5 class="modal-title">Aperturar Hidrotérmico</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <div class="modal-body">

                    <div class="row">
                        <div class="col-md-4">
                            <label>Canasta</label>
                            <select class="form-control">
                                <option>Canasta 1</option>
                                <option>Canasta 2</option>
                            </select>
                        </div>

                        <div class="col-md-4">
                            <label>Calibre</label>
                            <input type="text" class="form-control" value="12" readonly>
                        </div>

                        <div class="col-md-4">
                            <label>Tiempo</label>
                            <input type="text" class="form-control" value="75'" readonly>
                        </div><br><br><br><br>
                        <!-- NUEVA TARJETA INFORMATIVA -->
                        <div class="card mb-3 shadow-sm w-100"
                            style="background-color: #f5f5f5; border-radius: 8px; padding: 15px;">
                            <div class="row text-center">
                                <div class="col-md-4 col-12 mb-2">
                                    <div style="font-weight:bold; font-size:12px; color:#555;">N° TRATAMIENTO</div>
                                    <div style="font-size:18px; font-weight:600; color:#333;">TR-001</div>
                                </div>
                                <div class="col-md-4 col-12 mb-2">
                                    <div style="font-weight:bold; font-size:12px; color:#555;">N° TRATAMIENTO POR
                                        DESTINO</div>
                                    <div style="font-size:18px; font-weight:600; color:#333;">TD-002</div>
                                </div>
                                <div class="col-md-4 col-12 mb-2">
                                    <div style="font-weight:bold; font-size:12px; color:#555;">N° DE BACH</div>
                                    <div style="font-size:18px; font-weight:600; color:#333;">B-003</div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <hr>

                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr class="bg-info">
                                    <th>Lote</th>
                                    <th>Nº tarima</th>
                                    <th>Calibre</th>
                                    <th>Nro. jabas</th>
                                    <th>Pos. jabas tarimas</th>
                                    <th>Pos. tarimas canasta</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>LT001</td>
                                    <td>01</td>
                                    <td>6</td>
                                    <td>50</td>
                                    <td>1</td>
                                    <td>1</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <hr>

                    <div class="form-group d-flex align-items-center">

                        <div class="custom-control custom-radio mr-3">
                            <input type="radio" name="proceso" class="custom-control-input" id="r1" value="1" checked>
                            <label class="custom-control-label" for="r1">SIN HIDROCOOLER</label>
                        </div>

                        <div class="custom-control custom-radio mr-3">
                            <input type="radio" name="proceso" class="custom-control-input" id="r2" value="2">
                            <label class="custom-control-label" for="r2">CON HIDROCOOLER Y REPOSO</label>
                        </div>

                        <div class="custom-control custom-radio">
                            <input type="radio" name="proceso" class="custom-control-input" id="r3" value="3">
                            <label class="custom-control-label" for="r3">CON HIDROCOOLER SIN REPOSO</label>
                        </div>

                    </div>

                    <hr>

                    <!-- Contenedor que siempre tendrá los inputs del radio seleccionado -->
                    <div id="infoProceso"></div>

                    <hr>

                    <div class="row">
                        <div class="col-md-6">
                            <label>Temperatura Pulpa Inicial</label>
                            <input type="number" class="form-control">
                        </div>

                        <div class="col-md-6">
                            <label>Temperatura Pulpa Final</label>
                            <input type="number" class="form-control">
                        </div>
                    </div>

                    <!--  NUEVO BLOQUE: Contador y cambio de agua -->
                    <hr>
                    <div class="row">
                        <div class="col-md-12">
                            <label>Contador cambio agua: <span id="contadorAgua">0</span></label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="cambioAgua">
                                <label class="form-check-label" for="cambioAgua">Cambio de agua</label>
                            </div>
                            <div id="observacionesAgua" style="display:none; margin-top:10px;">
                                <textarea class="form-control" rows="3"
                                    placeholder="Ingrese observaciones..."></textarea>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="modal-footer">
                    <button class="btn bg-navy btn-block">Guardar</button>
                    <button class="btn btn-warning" data-dismiss="modal">Cerrar</button>
                </div>

            </div>
        </div>
    </div>

    <!-- NUEVO MODAL: Información de la canasta -->
    <div class="modal fade" id="canastaModal">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
            <div class="modal-header bg-info">
                <h5 class="modal-title">Detalle Canasta</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-body">
    <div class="table-responsive">
        <table class="table table-striped table-bordered table-hover text-center">
            <thead class="thead-dark">
                <tr>
                    <th>Posición de Tar. Canasta</th>
                    <th>Lote</th>
                    <th>N° de tarima</th>
                    <th>Calibre</th>
                    <th>Cantidad Jabas</th>
                    <th>Posición de JB. Tar.</th>
                    <th>DESTINO</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><input type="text" class="form-control" value="A"></td>
                    <td><input type="text" class="form-control" value="0008-inc-con"></td>
                    <td><input type="text" class="form-control" value="001"></td>
                    <td><input type="text" class="form-control" value="12"></td>
                    <td><input type="text" class="form-control" value="30"></td>
                    <td><input type="text" class="form-control" value="1-30"></td>
                    <td><input type="text" class="form-control" value="USA"></td>
                </tr>
                <tr>
                    <td><input type="text" class="form-control" value="B"></td>
                    <td><input type="text" class="form-control" value="0008-inc-con"></td>
                    <td><input type="text" class="form-control" value="002"></td>
                    <td><input type="text" class="form-control" value="12"></td>
                    <td><input type="text" class="form-control" value="8"></td>
                    <td><input type="text" class="form-control" value="1-8"></td>
                    <td><input type="text" class="form-control" value="USA"></td>
                </tr>
                <tr>
                    <td><input type="text" class="form-control" value="B"></td>
                    <td><input type="text" class="form-control" value="0009-inc-con"></td>
                    <td><input type="text" class="form-control" value="002"></td>
                    <td><input type="text" class="form-control" value="12"></td>
                    <td><input type="text" class="form-control" value="15"></td>
                    <td><input type="text" class="form-control" value="9-23"></td>
                    <td><input type="text" class="form-control" value="USA"></td>
                </tr>
                <tr>
                    <td><input type="text" class="form-control" value="C"></td>
                    <td><input type="text" class="form-control" value="0009-inc-con"></td>
                    <td><input type="text" class="form-control" value="003"></td>
                    <td><input type="text" class="form-control" value="12"></td>
                    <td><input type="text" class="form-control" value="30"></td>
                    <td><input type="text" class="form-control" value="1-30"></td>
                    <td><input type="text" class="form-control" value="USA"></td>
                </tr>
                <tr>
                    <td><input type="text" class="form-control" value="D"></td>
                    <td><input type="text" class="form-control" value="0010-KOR-con"></td>
                    <td><input type="text" class="form-control" value="005"></td>
                    <td><input type="text" class="form-control" value="12"></td>
                    <td><input type="text" class="form-control" value="16"></td>
                    <td><input type="text" class="form-control" value="1-16"></td>
                    <td><input type="text" class="form-control" value="USA"></td>
                </tr>
                <tr>
                    <td><input type="text" class="form-control" value="E"></td>
                    <td><input type="text" class="form-control" value="0010-KOR-con"></td>
                    <td><input type="text" class="form-control" value="006"></td>
                    <td><input type="text" class="form-control" value="12"></td>
                    <td><input type="text" class="form-control" value="16"></td>
                    <td><input type="text" class="form-control" value="1-16"></td>
                    <td><input type="text" class="form-control" value="USA"></td>
                </tr>
                <tr>
                    <td><input type="text" class="form-control" value="F"></td>
                    <td><input type="text" class="form-control" value="0013-GOL-con"></td>
                    <td><input type="text" class="form-control" value="038"></td>
                    <td><input type="text" class="form-control" value="12"></td>
                    <td><input type="text" class="form-control" value="30"></td>
                    <td><input type="text" class="form-control" value="1-30"></td>
                    <td><input type="text" class="form-control" value="USA"></td>
                </tr>
                <tr>
                    <td><input type="text" class="form-control" value="G"></td>
                    <td><input type="text" class="form-control" value="0015-GOL-con"></td>
                    <td><input type="text" class="form-control" value="045"></td>
                    <td><input type="text" class="form-control" value="12"></td>
                    <td><input type="text" class="form-control" value="30"></td>
                    <td><input type="text" class="form-control" value="1-30"></td>
                    <td><input type="text" class="form-control" value="USA"></td>
                </tr>
                <tr>
                    <td><input type="text" class="form-control" value="H"></td>
                    <td><input type="text" class="form-control" value="0010-KOR-con"></td>
                    <td><input type="text" class="form-control" value="004"></td>
                    <td><input type="text" class="form-control" value="12"></td>
                    <td><input type="text" class="form-control" value="30"></td>
                    <td><input type="text" class="form-control" value="1-30"></td>
                    <td><input type="text" class="form-control" value="USA"></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" data-dismiss="modal">Cerrar</button>
            </div>
            </div>
        </div>
    </div>


    <script src="resorce/plugins/jquery/jquery.min.js"></script>
    <script src="resorce/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="resorce/dist/js/adminlte.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

    <script>
        $(function () {

            $(".canasta").draggable({
                revert: "invalid",
                helper: "clone"
            });

            $(".tank-body").droppable({
                accept: ".canasta",
                hoverClass: "zona-hover",
                drop: function (event, ui) {
                    var tinaCard = $(this).closest(".tina-card");
                    var num = ui.draggable.data("id");

                    // NUEVO: Aplica degradado rojo calor al tanque
                    tinaCard.addClass("tina-activa tina-calor");
                    tinaCard.find(".tina-status").html("CANASTA " + num);
                }
            });

            $(".tina-card").click(function () {
                $("#aperturarModal").modal("show");
                renderProceso(1);
            });

            // DOBLE CLIC en canasta
            $(".canasta").dblclick(function() {
                var id = $(this).data("id");
                var tiempo = $(this).data("tiempo");
                $("#canastaInfo").html(`
                    <strong>Canasta:</strong> ${id} <br>
                    <strong>Tiempo estimado:</strong> ${tiempo} min
                `);
                $("#canastaModal").modal("show");
            });



            $("input[name='proceso']").change(function () {
                renderProceso($(this).val());
            });

            function renderProceso(valor) {
                let ahora = new Date();
                let inicio = ahora.toISOString().slice(0, 16);
                let fin = new Date(ahora.getTime() + (75 * 60000));
                let finFormat = fin.toISOString().slice(0, 16);

                if (valor == "1") {
                    $("#infoProceso").html(`
<div class="row">
<div class="col-md-3 mb-2">
<label>Inicio Hidrotérmico</label>
<input type="datetime-local" class="form-control" value="${inicio}">
</div>
<div class="col-md-3 mb-2">
<label>Fin Hidrotérmico</label>
<input type="datetime-local" class="form-control" value="${finFormat}">
</div>
<div class="col-md-3 mb-2">
<label>Hora Final Proyectada</label>
<input type="datetime-local" class="form-control" value="${finFormat}">
</div>
<div class="col-md-3 mb-2">
<label>Tiempo estimado</label>
<input type="text" class="form-control" value="75 min" readonly>
</div>
</div>
`);
                } else if (valor == "2") {
                    $("#infoProceso").html(`
<div class="row">
<div class="col-md-3 mb-2">
<label>Tiempo restante</label>
<input type="text" class="form-control" value="75 min" readonly>
</div>
<div class="col-md-3 mb-2">
<label>Inicio Hidrotérmico</label>
<input type="datetime-local" class="form-control" value="${inicio}">
</div>
<div class="col-md-3 mb-2">
<label>Fin Hidrotérmico</label>
<input type="datetime-local" class="form-control" value="${finFormat}">
</div>
<div class="col-md-3 mb-2">
<label>Hora de salida</label>
<input type="datetime-local" class="form-control">
</div>
<div class="col-md-3 mb-2">
<label>Inicio Reposo</label>
<input type="datetime-local" class="form-control">
</div>
<div class="col-md-3 mb-2">
<label>Fin Reposo</label>
<input type="datetime-local" class="form-control">
</div>
<div class="col-md-3 mb-2">
<label>Inicio Frío</label>
<input type="datetime-local" class="form-control">
</div>
<div class="col-md-3 mb-2">
<label>Fin Frío</label>
<input type="datetime-local" class="form-control">
</div>
</div>
`);
                } else if (valor == "3") {
                    $("#infoProceso").html(`
<div class="row">
<div class="col-md-3 mb-2">
<label>Inicio Hidrotérmico</label>
<input type="datetime-local" class="form-control" value="${inicio}">
</div>
<div class="col-md-3 mb-2">
<label>Fin Hidrotérmico</label>
<input type="datetime-local" class="form-control" value="${finFormat}">
</div>
<div class="col-md-3 mb-2">
<label>Hora Final Proyectada</label>
<input type="datetime-local" class="form-control" value="${finFormat}">
</div>
<div class="col-md-3 mb-2">
<label>Tiempo estimado</label>
<input type="text" class="form-control" value="75 min" readonly>
</div>
</div>
`);
                }
            }

            // ================= Cambio de agua =================
            let contador = 0;
            let cambioAguaActivado = false;

            $("#cambioAgua").change(function () {
                if ($(this).is(":checked") && !cambioAguaActivado) {
                    contador += 1;
                    $("#contadorAgua").text(contador);
                    cambioAguaActivado = true;
                    $("#observacionesAgua").slideDown();
                } else if (!$(this).is(":checked")) {
                    $("#observacionesAgua").slideUp();
                }
            });

        });

    </script>
    <script>
        $(function () {
            $(".canasta").draggable({
                revert: "invalid",
                helper: "clone"
            });

            $(".tank-body").droppable({
                accept: ".canasta",
                hoverClass: "zona-hover",
                drop: function (event, ui) {
                    var tinaCard = $(this).closest(".tina-card");
                    var num = ui.draggable.data("id");

                    tinaCard.addClass("tina-activa tina-calor tina-calor-animado");
                    tinaCard.find(".tina-status").html("CANASTA " + num);

                    // Tiempo total en milisegundos
                    let tiempoTotal = 75000; // 75s simulando 75 min
                    let tiempoCasiSalida = 69000; // 1 minuto antes (74s)

                    setTimeout(() => {
                        // Cambiar a azul fosforescente
                        tinaCard.removeClass("tina-calor-animado").addClass("tina-casi-salida");
                    }, tiempoCasiSalida);

                    setTimeout(() => {
                        // Quitar todo efecto cuando termine
                        tinaCard.removeClass("tina-casi-salida tina-activa tina-calor");
                        tinaCard.find(".tina-status").html("DISPONIBLE");
                    }, tiempoTotal);

                }
            });
        });
    </script>

</body>

</html>